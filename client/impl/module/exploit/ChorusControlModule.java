package net.shoreline.client.impl.module.exploit;

import net.minecraft.class_1657;
import net.minecraft.class_1757;
import net.minecraft.class_1799;
import net.minecraft.class_238;
import net.minecraft.class_243;
import net.minecraft.class_2596;
import net.minecraft.class_2708;
import net.minecraft.class_2793;
import net.minecraft.class_2828;
import net.shoreline.client.api.event.EventStage;
import net.shoreline.client.api.event.listener.EventListener;
import net.shoreline.client.api.module.ModuleCategory;
import net.shoreline.client.api.module.ToggleModule;
import net.shoreline.client.api.render.RenderManager;
import net.shoreline.client.impl.event.TickEvent;
import net.shoreline.client.impl.event.network.PacketEvent;
import net.shoreline.client.impl.event.render.RenderWorldEvent;
import net.shoreline.client.init.Modules;

public class ChorusControlModule extends ToggleModule {
   private boolean cancelChorusTeleport;
   private int chorusTeleportId;
   private class_2708 teleportPacket;

   public ChorusControlModule() {
      super("ChorusControl", "Allows player to control chorus teleports", ModuleCategory.EXPLOITS);
   }

   public void onDisable() {
      if (mc.method_1562() != null && this.teleportPacket != null) {
         mc.method_1562().method_11157(this.teleportPacket);
      }

      this.teleportPacket = null;
      this.cancelChorusTeleport = false;
   }

   @EventListener
   public void onPacketOutbound(PacketEvent.Outbound event) {
      if (this.cancelChorusTeleport) {
         class_2596 var4 = event.getPacket();
         if (var4 instanceof class_2828) {
            class_2828 packet = (class_2828)var4;
            if (packet.method_36171()) {
               event.cancel();
               return;
            }
         }

         var4 = event.getPacket();
         if (var4 instanceof class_2793) {
            class_2793 packet = (class_2793)var4;
            event.cancel();
            this.chorusTeleportId = packet.method_12086();
         }
      }

   }

   @EventListener
   public void onPacketInbound(PacketEvent.Inbound event) {
      class_2596 var3 = event.getPacket();
      if (var3 instanceof class_2708) {
         class_2708 packet = (class_2708)var3;
         if (this.cancelChorusTeleport) {
            event.cancel();
            this.teleportPacket = packet;
         }
      }

   }

   @EventListener
   public void onTick(TickEvent event) {
      if (event.getStage() == EventStage.PRE) {
         if (!this.cancelChorusTeleport && mc.field_1724.method_6115()) {
            class_1799 stack = mc.field_1724.method_5998(mc.field_1724.method_6058());
            if (stack.method_7909() instanceof class_1757 && stack.method_7935() - mc.field_1724.method_6048() <= 1) {
               this.cancelChorusTeleport = true;
            }
         }

      }
   }

   @EventListener
   public void onRenderWorld(RenderWorldEvent event) {
      if (this.teleportPacket != null) {
         class_243 vec3d = new class_243(this.teleportPacket.method_11734(), this.teleportPacket.method_11735(), this.teleportPacket.method_11738());
         class_238 teleportBox = class_1657.field_18135.method_30757(vec3d);
         RenderManager.renderBox(event.getMatrices(), teleportBox, Modules.COLORS.getRGB(60));
         RenderManager.renderBoundingBox(event.getMatrices(), teleportBox, 1.5F, Modules.COLORS.getRGB(145));
      }

   }
}

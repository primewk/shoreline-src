package net.shoreline.client.impl.module.exploit;

import java.text.DecimalFormat;
import net.minecraft.class_1799;
import net.minecraft.class_1802;
import net.minecraft.class_2596;
import net.minecraft.class_2846;
import net.minecraft.class_2848;
import net.minecraft.class_2886;
import net.minecraft.class_2828.class_2829;
import net.minecraft.class_2846.class_2847;
import net.minecraft.class_2848.class_2849;
import net.shoreline.client.api.config.Config;
import net.shoreline.client.api.config.setting.BooleanConfig;
import net.shoreline.client.api.config.setting.NumberConfig;
import net.shoreline.client.api.event.listener.EventListener;
import net.shoreline.client.api.module.ModuleCategory;
import net.shoreline.client.api.module.ToggleModule;
import net.shoreline.client.impl.event.network.PacketEvent;
import net.shoreline.client.init.Managers;
import net.shoreline.client.util.math.timer.CacheTimer;
import net.shoreline.client.util.math.timer.Timer;

public class FastProjectileModule extends ToggleModule {
   Config<Float> chargeConfig = new NumberConfig("Charge", "Time to charge after applying fast projectiles", 1.0F, 2.0F, 5.0F);
   Config<Boolean> arrowConfig = new BooleanConfig("Arrow", "Applies to arrows shot from a bow", true);
   Config<Boolean> potionConfig = new BooleanConfig("Potion", "Applies to splash/lingering potions", false);
   Config<Boolean> pearlConfig = new BooleanConfig("EnderPearl", "Applies to ender pearls", false);
   Config<Boolean> snowballConfig = new BooleanConfig("Snowball", "Applies to snowball", false);
   Config<Boolean> eggConfig = new BooleanConfig("Egg", "Applies to eggs", false);
   Config<Boolean> tridentConfig = new BooleanConfig("Trident", "Applies to thrown tridents", false);
   private final Timer chargeTimer = new CacheTimer();

   public FastProjectileModule() {
      super("FastProjectile", "Allows projectiles to travel at absurd speeds", ModuleCategory.EXPLOITS);
   }

   public String getModuleData() {
      if (this.chargeTimer.passed((Float)this.chargeConfig.getValue() * 1000.0F)) {
         return "Charged";
      } else {
         DecimalFormat decimal = new DecimalFormat("0.0");
         String var10000 = decimal.format((double)((2000.0F - (float)this.chargeTimer.getElapsedTime()) / 1000.0F));
         return var10000 + "s";
      }
   }

   @EventListener
   public void onPacketOutbound(PacketEvent.Outbound event) {
      if (mc.field_1724 != null) {
         if (this.chargeTimer.passed((Float)this.chargeConfig.getValue() * 1000.0F)) {
            class_2596 var4 = event.getPacket();
            class_1799 stack;
            if (var4 instanceof class_2886) {
               class_2886 packet = (class_2886)var4;
               stack = mc.field_1724.method_5998(packet.method_12551());
               if ((stack.method_7909() == class_1802.field_8436 || stack.method_7909() == class_1802.field_8150) && (Boolean)this.potionConfig.getValue() || stack.method_7909() == class_1802.field_8634 && (Boolean)this.pearlConfig.getValue() || stack.method_7909() == class_1802.field_8543 && (Boolean)this.snowballConfig.getValue() || stack.method_7909() == class_1802.field_8803 && (Boolean)this.eggConfig.getValue()) {
                  this.chargeTimer.reset();
                  this.spoofProjectileVelocity();
               }
            } else {
               var4 = event.getPacket();
               if (var4 instanceof class_2846) {
                  class_2846 packet = (class_2846)var4;
                  if (packet.method_12363() == class_2847.field_12974) {
                     stack = mc.field_1724.method_6047();
                     if (stack.method_7909() == class_1802.field_8102 && (Boolean)this.arrowConfig.getValue()) {
                        this.chargeTimer.reset();
                        this.spoofProjectileVelocity();
                     }
                  }
               }
            }

         }
      }
   }

   private void spoofProjectileVelocity() {
      double x = mc.field_1724.method_23317();
      double y = mc.field_1724.method_23318();
      double z = mc.field_1724.method_23321();
      Managers.NETWORK.sendPacket(new class_2848(mc.field_1724, class_2849.field_12981));

      for(int i = 0; i < 100; ++i) {
         Managers.NETWORK.sendPacket(new class_2829(x, y - 1.0E-10D, z, true));
         Managers.NETWORK.sendPacket(new class_2829(x, y + 1.0E-10D, z, false));
      }

   }
}
